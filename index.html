<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loan Table Generator</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#7c3aed;
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.03);
      --msg-bg: rgba(124,58,237,0.12);
    }
    *{box-sizing:border-box}
    body{
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, #071127 0%, #07182a 60%);
      color:#e6eef8;
      padding:28px;
    }

    .app {
      width:100%;
      max-width:1100px;
      border-radius:16px;
      padding:20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 8px 30px rgba(2,6,23,0.7);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.03);
    }

    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    header h1{
      margin:0;
      font-size:20px;
      letter-spacing:0.2px;
    }
    header p{margin:0;color:var(--muted);font-size:13px}

    form.controls {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
      gap:12px;
      margin-bottom:10px;
    }

    .field {
      display:flex;
      flex-direction:column;
    }
    label {
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    input[type="number"], select {
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.05);
      background:var(--glass);
      color:inherit;
      outline:none;
      font-size:14px;
    }

    .options {
      display:flex;
      align-items:center;
      gap:12px;
    }
    .btn {
      padding:10px 14px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:600;
    }
    .btn.primary {
      background:linear-gradient(90deg,var(--accent), #4f46e5);
      color:white;
      box-shadow: 0 6px 18px rgba(124,58,237,0.18);
    }
    .btn.ghost {
      background:transparent;
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.03);
    }

    .table-wrap {
      margin-top:18px;
      overflow:auto;
      border-radius:12px;
      padding:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px solid rgba(255,255,255,0.02);
    }

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 8px;
      min-width:820px;
    }
    thead th{
      text-align:left;
      font-size:13px;
      padding:10px 12px;
      color:var(--muted);
      font-weight:600;
      letter-spacing:0.2px;
    }
    tbody td{
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      padding:12px;
      font-size:14px;
      border-top:1px solid rgba(255,255,255,0.01);
      border-bottom:1px solid rgba(0,0,0,0.15);
    }
    tbody tr td:first-child { border-top-left-radius:8px; border-bottom-left-radius:8px;}
    tbody tr td:last-child { border-top-right-radius:8px; border-bottom-right-radius:8px;}

    .muted { color:var(--muted); font-size:13px; }

    .small {
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }

    .msg {
      margin-top:8px;
      padding:10px 12px;
      border-radius:10px;
      background:var(--msg-bg);
      color: #efe7ff;
      font-size:13px;
      display:none;
      border:1px solid rgba(124,58,237,0.25);
    }

    /* --- small responsive tweaks for mobile --- */
    @media (max-width:800px){
      header{flex-direction:column;align-items:flex-start;gap:8px}
      .table-wrap { padding:8px; }
      table { min-width:640px; } 
      thead th, tbody td { padding:10px 8px; font-size:13px; }
      input[type="number"], select { font-size:15px; padding:12px; }
      .field.options { flex-direction:column; align-items:flex-start; gap:8px; }
      .field.options .btn { width:100%; }
    }
    @media (max-width:420px){
      table { min-width:560px; }
      thead th, tbody td { font-size:12px; padding:8px 6px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Loan table generator</h1>
        <p class="muted">Enter totals — table will show monthly interest, EMI (principal part) and totals.</p>
      </div>
      <div class="small">Made quick & simple ✨</div>
    </header>

    <form id="form" class="controls" onsubmit="return false;">
      <div class="field">
        <label>Total Amount</label>
        <input id="totalAmount" type="number" min="0" step="0.01" value="20000" />
      </div>

      <div class="field">
        <label>Interest Rate (1–10) — enter 1 for 1%, 2 for 2%, etc.</label>
        <input id="interestRate" type="number" min="1" max="10" step="1" value="6" />
        <div id="interestHint" class="small">Use numbers 1..10 (1 = 1%). Keep the dropdown to choose how it's applied.</div>
      </div>

      <div class="field">
        <label>Total Months</label>
        <input id="months" type="number" min="1" step="1" value="8" />
      </div>

      <div class="field options" style="align-items:center;grid-column: span 3;">
        <label style="margin-right:6px;">Interpretation</label>
        <select id="rateMode" style="max-width:240px">
          <option value="annual" selected>Number is annual % (we use value ÷ 12 per month)</option>
          <option value="monthly">Number is monthly % directly</option>
        </select>

        <button id="generate" class="btn primary" style="margin-left:auto">Generate Table</button>
        <button id="reset" class="btn ghost" type="button">Reset</button>
      </div>
    </form>

    <div id="ruleMsg" class="msg" role="status" aria-live="polite"></div>

    <div id="tableContainer" class="table-wrap" hidden>
      <table id="resultTable" aria-live="polite">
        <thead>
          <tr>
            <th>Month</th>
            <th>Opening Balance</th>
            <th>Monthly Interest (%)</th>
            <th>Interest Amount</th>
            <th>EMI (Principal)</th>
            <th>Total Amount (EMI + Interest)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="note" class="small" style="margin-top:8px;color:var(--muted);display:none"></div>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);
    const format = n => Number(n).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 2 });

    // helpers
    function parseNumberFromInput(el) {
      if (!el) return 0;
      // remove commas/spaces and coerce to Number
      const raw = String(el.value).replace(/,/g, '').trim();
      const num = Number(raw);
      return Number.isFinite(num) ? num : 0;
    }
    function setMsg(text, show = true) {
      const el = $('#ruleMsg');
      if (!text || !show) {
        el.style.display = 'none';
        el.textContent = '';
      } else {
        el.style.display = 'block';
        el.textContent = text;
      }
    }

    // track last active rule so we don't spam the same alerts repeatedly
    let lastRule = null;

    function applyRuleForTotal(totalVal, triggerAlert = true) {
      const rateEl = $('#interestRate');
      const hint = $('#interestHint');

      if (totalVal <= 20000) {
        // fixed to 7, disable
        const min = 7, max = 7;
        rateEl.min = min; rateEl.max = max; rateEl.step = 1;
        if (Number(rateEl.value) !== 7) rateEl.value = 7;
        rateEl.disabled = true;
        hint.textContent = 'Total ≤ 20,000 — interest fixed to 7% (field disabled).';
        setMsg('Interest fixed to 7% for totals ≤ 20,000.');
        if (lastRule !== 'le20000' && triggerAlert) alert('Total amount is ≤ 20,000 — interest fixed to 7% and field disabled.');
        lastRule = 'le20000';
        return {min, max, rule:'le20000'};
      }

      if (totalVal > 20000 && totalVal <= 30000) {
        const min = 6, max = 7;
        rateEl.min = min; rateEl.max = max; rateEl.step = 1;
        rateEl.disabled = false;
        // clamp current value if outside
        let cur = Number(rateEl.value) || min;
        if (cur < min || cur > max) {
          // clamp and inform
          rateEl.value = min;
          if (triggerAlert) alert('Total is between 20,001 and 30,000 — interest allowed values are 6 or 7%. Value set to 6.');
        }
        hint.textContent = 'Total between 20,001 and 30,000 — interest must be 6 or 7%.';
        setMsg('Interest must be 6 or 7% for totals between 20,001 and 30,000.');
        if (lastRule !== 'bt20001_30000' && triggerAlert) alert('Total is between 20,001 and 30,000 — interest must be 6 or 7%.');
        lastRule = 'bt20001_30000';
        return {min, max, rule:'bt20001_30000'};
      }

      // totalVal > 30000
      const min = 8, max = 10;
      rateEl.min = min; rateEl.max = max; rateEl.step = 1;
      rateEl.disabled = false;
      let cur = Number(rateEl.value) || min;
      if (cur < min || cur > max) {
        rateEl.value = min;
        if (triggerAlert) alert('Total is ≥ 30,000 — interest allowed values are 8, 9 or 10%. Value set to 8.');
      }
      hint.textContent = 'Total ≥ 30,000 — interest must be 8, 9 or 10%.';
      setMsg('Interest must be 8–10% for totals ≥ 30,000.');
      if (lastRule !== 'ge30000' && triggerAlert) alert('Total is ≥ 30,000 — interest must be 8, 9 or 10%.');
      lastRule = 'ge30000';
      return {min, max, rule:'ge30000'};
    }

    // called whenever the totalAmount changes or on load
    function enforceInterestRules(triggerAlert = false) {
      const totalVal = parseNumberFromInput($('#totalAmount'));
      return applyRuleForTotal(totalVal, triggerAlert);
    }

    function computeAndRender() {
      const total = parseNumberFromInput($('#totalAmount'));
      const months = Math.max(1, parseInt($('#months').value || 0, 10));
      // enforce rules first (and allow alerts to fire)
      const rule = enforceInterestRules(true);

      // read and validate interest after rule enforcement
      const rateRaw = $('#interestRate').value;
      const rateInput = Number(String(rateRaw).replace(/,/g,'').trim()) || 0;

      if (total <= 0 || months <= 0) {
        alert('Enter valid Total Amount and Months.');
        return;
      }

      // validate interest range
      const rateMin = Number($('#interestRate').min) || 1;
      const rateMax = Number($('#interestRate').max) || 10;
      if (rateInput < rateMin || rateInput > rateMax) {
        alert(`Interest must be between ${rateMin} and ${rateMax} for this total amount. Adjust the Total Amount or Interest.`);
        return;
      }

      // principal per month
      const principalPerMonth = total / months;
      const mode = $('#rateMode').value;
      // interpret rateInput as percent, compute monthly decimal
      const monthlyPercentDecimal = mode === 'annual' ? (rateInput / 100) / 12 : (rateInput / 100);

      const tbody = $('#resultTable tbody');
      tbody.innerHTML = '';
      let opening = total;

      for (let m = 1; m <= months; m++) {
        const interestAmt = opening * monthlyPercentDecimal;
        const totalForMonth = principalPerMonth + interestAmt;
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${m}</td>
          <td>${format(opening)}</td>
          <td>${(monthlyPercentDecimal*100).toFixed(3)}%</td>
          <td>${format(interestAmt)}</td>
          <td>${format(principalPerMonth)}</td>
          <td>${format(totalForMonth)}</td>
        `;
        tbody.appendChild(tr);

        opening = opening - principalPerMonth;
        if (opening < 0.00001) opening = 0;
      }

      $('#tableContainer').hidden = false;
      $('#note').style.display = 'block';
      $('#note').textContent = `You entered ${rateInput} → interpreted as ${rateInput}% (${mode === 'annual' ? 'annual ÷ 12 per month' : 'monthly directly'}). EMI (principal) = ${format(principalPerMonth)} per month.`;
    }

    // events
    document.getElementById('generate').addEventListener('click', computeAndRender);

    document.getElementById('reset').addEventListener('click', () => {
      $('#totalAmount').value = 20000;
      $('#interestRate').value = 6;
      $('#months').value = 8;
      $('#rateMode').value = 'annual';
      $('#tableContainer').hidden = true;
      $('#note').style.display = 'none';
      lastRule = null;
      setMsg('', false);
      enforceInterestRules(false);
    });

    // attach robust listeners
    const totalInput = $('#totalAmount');
    ['input','change','blur','paste'].forEach(e => totalInput.addEventListener(e, () => enforceInterestRules(e !== 'input')));

    // also keep interest value clamped if user types
    $('#interestRate').addEventListener('input', () => {
      const el = $('#interestRate');
      const min = Number(el.min) || 1;
      const max = Number(el.max) || 10;
      let val = Number(String(el.value).replace(/,/g,'').trim());
      if (!Number.isFinite(val)) val = min;
      if (val < min) val = min;
      if (val > max) val = max;
      el.value = Math.round(val);
    });

    // initial setup on load
    window.addEventListener('load', () => {
      enforceInterestRules(false);
      computeAndRender();
    });
  </script>
</body>
</html>
